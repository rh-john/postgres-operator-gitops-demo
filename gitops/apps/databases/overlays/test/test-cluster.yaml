apiVersion: "acid.zalan.do/v1"
kind: postgresql
metadata:
  name: test-cluster
  namespace: dba-test
  labels:
    environment: test
    owner: dba-test
  annotations:
    argocd.argoproj.io/sync-wave: "2"  # Create PostgreSQL cluster after RBAC
spec:
  teamId: "test-team"
  
  # 2 instances for HA testing
  numberOfInstances: 2
  
  users:
    testuser:
      - superuser
      - createdb
    readonly: []
  
  databases:
    testdb: testuser
  
  postgresql:
    version: "16"
    parameters:
      shared_buffers: "512MB"
      max_connections: "100"
      work_mem: "8MB"
      log_statement: "ddl"
      log_min_duration_statement: "500"
  
  volume:
    size: 10Gi
  
  resources:
    requests:
      cpu: 200m
      memory: 500Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  enableMasterLoadBalancer: true
  enableReplicaLoadBalancer: true
  
  podAnnotations:
    environment: test
